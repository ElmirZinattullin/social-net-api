# Сервис микроблогов
Реализован бэкенд сервиса микроблоков на фреймворке FastAPI.  
### Содержание:  
1. FastAPI приложение - app.src.api_app.app:app
2. settings.py - загрузка переменных окружения
   * DATABASE - название базы данных (Postgres)
   * DATABASE_USER - пользователь Postgres
   * DATABASE_PASSWORD - пароль Postgres
   * DEBUG - Возможные значения 0 или 1
   * API_ROUTE - роут встраивания апи приложения 
3. app_depends.py - подключение зависимостей с базой данных
4. crud.py - сервис для работы с базой данных
5. customopenapi.py - сервис для изменения генерируемой документации OpenAPI
6. database.py - подключение к базе данных
7. file_service.py - сервис для сохранения загруженных изображений
8. models.py - ОРМ модели
9. schemas.py - Схемы для описания response/request схем фреймворка

### Тестирование
Для запуска тестирования необходима библиотека pytest и установленные зависимости из файла app/src/requirements.txt
Находясь в корне проекте выполните команду pytest.  
**ВНИМАНИЕ:** Не законченные тесты могут создавать файлы изображения в папке tests. Они могут быть удалены вручную.


### Запуск FastAPI приложения отдельно

Для работы приложения требуются:
- Python версии не ниже 3.10.12
- установленные зависимости из файла app/src/requirements.txt
- запущенная и доступная база данных Postgres

После выполнения требований необходимо запустить скрипт app/src/run.py c переменными окружения описанными в .env.template
при этом для корректной работы API_ROUTE = ""  
После запуска веб-сервис API будет доступен на http://localhost:8000/  
OpenApi docs http://localhost:8000/docs

_При этом не будет доступен фронт интерфейс_

### Запуск FastAPI приложения через Docker-compose

Для работы приложения требуются:
- установленное ПО для контейнеризации - [Docker](https://docs.docker.com/engine/install/).
- установленные ПО для запуска многоконтейнерных приложений - [Docker-compose](https://docs.docker.com/compose/)

1. Создайте на основе файла **.env.template** файл **.env** в корне проекта;  
2. Находясь в директории проекта выполните команду ```$docker compose build ```;  
3. Дождитесь установки;  
4. Выполните команду ```$docker compose up```

При этом будет доступен сайт микроблогов на http://localhost
API для сайта http://localhost/api или http://localhost:8000
Документация OpenAPI для API доступна на http://loclhost/api/docs  

### Конечные точки API

* GET /users/me  - информация о текущем пользователе
* GET /users/<id>  - информация о пользователе по идентификатору
* POST /tweets  - создание твита
* POST /medias  - загрузка изображения
* DELETE /tweets/<id>  - удаление твита по идентификатору
* POST /tweets/<id>/likes  - отметка нравится твита по идентификатору
* DELETE /tweets/<id>/likes  - удаление отметки нравится твита по идентификатору
* POST /users/<id>/follow  - добавления пользователя в подписки по идентификатору
* DELETE /users/<id>/follow  - отписка от пользователя по идентификатору
* GET /api/tweets  - получение ленты твитов

При обращении к конечным точкам необходим заголовок ```header: api-key``` содержащий апи ключ текущего пользователя

### Наполнение базы данных записями

Вы можете быстро заполнить запущенную базу данных тестовой информацией для просмотра фрона+бэкенда. Для этого выполните скрипт tests/generate_db.py. Если потребуется переназначьте переменные  
DATABASE_USER = "user"  
DATABASE_PASSWORD = "pass"  
DATABASE_PORT = 5432  
DATABASE = "db"  